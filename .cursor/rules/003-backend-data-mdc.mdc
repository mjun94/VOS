---
alwaysApply: true
---

description: 백엔드 및 데이터베이스 규칙 (MSSQL, Server Actions)

# 기술 스택 (Tech Stack)

- **Database**: MSSQL (SQL Server) — 연결 풀(Connection Pool) 또는 드라이버(mssql, tedious) 사용
- **API Strategy**: Server Actions (Next.js 16, BFF 패턴)
- **Tooling**: Cursor MCP (Model Context Protocol) — **MSSQL MCP**로 스키마 조회·쿼리 실행

# MSSQL MCP & Server Actions 활용 규칙 (가장 중요)

1. **스키마 확인 필수 (READ SCHEMA FIRST)**:
   - 데이터베이스 관련 코드를 짜기 전에, **MSSQL MCP 툴을 사용하여 현재 테이블/컬럼 구조를 먼저 조회**하세요.
   - MCP 호출 전 `mcps/<mssql-server>/tools/*.json` 등에서 툴 스키마(파라미터, 사용법)를 확인한 뒤 호출하세요.
   - 테이블 이름이나 컬럼 이름을 절대 추측해서 작성하지 마세요. (할루시네이션 방지)

2. **Server Actions 사용**:
   - 데이터를 저장/수정/삭제할 때는 `pages/api`나 `route.ts`를 만들지 마세요.
   - Next.js의 **Server Actions (`'use server'`)** 기능을 사용하여 함수 형태로 구현하세요.

3. **보안 (권한 & 인증)**:
   - 쿼리 실행 시 **로그인 여부·권한**을 Server Action 내부에서 검사하세요. (예: 세션에서 userId 확인 후 본인 데이터만 수정 허용)
   - MSSQL 측에서는 필요 시 **DB 사용자/역할(Role)** 과 권한(Grant)으로 테이블 접근을 제한할 수 있습니다.
   - 인증은 NextAuth.js 또는 자체 세션(쿠키 + MSSQL 사용자 테이블)으로 관리하세요.

4. **타입 안전성**:
   - `any` 타입 사용을 지양하세요. 쿼리 결과는 인터페이스/타입을 정의해 사용하세요.

5. **환경변수 및 MCP**:
   - `.env`에 MSSQL 연결 정보(호스트, 포트, DB명, 사용자, 비밀번호)를 두고, Server Actions·API 레이어에서만 사용하세요. 클라이언트에 노출되지 않도록 합니다.
   - MSSQL MCP를 사용할 때는 Cursor MCP 서버 설정에 동일 연결 정보를 넣어 두세요. 필요한 경우 `.env.example`에 MCP용 변수 설명을 추가합니다.
